<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport">
    <title>reddit-min</title>
</head>

<body>
    <div id="navBar">
        <div id="subredditNavBar" class="wiggleRoom"></div>

        <h1>minimised-reddit</h1>

        <h2> r/</h2>
        <input id="subIn" class="textbox"></input>
        <button id="subEnterButton" onclick="goClicked()">GO</button>
        <br>
        <h2>browser other subreddits ^^</h2>
        <br>
        <br>
        <br>
        <h2 id="subredditDisplay"></h2>
        <br>
        <br>
    </div>
    <div id="mainPage"></div>
</body>

<style>
    html {
        background-color: rgb(8, 8, 8);
    }

    h1,
    h2,
    p,
    h7,
    h8,
    h4,
    h3,
    a {
        color: white;
    }

    div {
        border: 1px solid lime;
        word-wrap: break-word;
    }

    a:hover {
        cursor: pointer;
        font-weight: bold;
    }

    h7,
    h8,
    h4,
    h3,
    h2 {
        margin-left: 40;
        padding: 0;
        display: inline
    }

    body {
        font-family: Arial, Helvetica, sans-serif;
    }

    img {
        margin-right: 10px;
    }

    .textbox {
        width: 300px;
        height: 30px;
        font-size: 15pt;
    }

    .wiggleRoom {
        margin-top: 20px;
        margin-bottom: 20px;
        font-size: 16;
    }
</style>

<script>
    var divShortcut = document.getElementById("mainPage");
    var imgHeights = {};
    var latestID = "";
    var curSubr = "";

    var randomStartSubs = [
        "pics",
        "funny",
        "todayilearned",
        "gaming",
        "mildlyinteresting",
        "Showerthoughts",
        "Jokes",
        "all",
        "wtf",
        "tumblr"
    ];

    for (var i = 0; i < randomStartSubs.length; i++) {
        var subBook = document.createElement("a");
        var subDivShort = document.getElementById("subredditNavBar");
        subBook.setAttribute("onclick", "structSubreddit( '" + randomStartSubs[i] + "' )");
        subBook.innerHTML = "-   r/" + randomStartSubs[i] + "  -";
        subDivShort.appendChild(subBook);
    }

    var randomSub = randomStartSubs[randomStartSubs.length - 1];
    console.log("r/" + randomSub);
    structSubreddit("gaming");

    function goClicked() {
        console.log("going to subreddit");
        if (document.getElementById("subIn").value != undefined) {
            console.log(document.getElementById("subIn").value);
            structSubreddit(document.getElementById("subIn").value);
        }
    }

    function structSubreddit(subName) {

        curSubr = subName;
        document.getElementById("subredditDisplay").innerHTML = "r/" + curSubr;
        divShortcut.innerHTML = '';

        getUrlJSON("https://www.reddit.com/r/" + subName + "/new.json?sort=new", function (data) {

            var subRawData = data;
            var subChildren = data.data.children;

            for (var i = 0; i < data.data.dist - 3; i++) {
                // console.log("i" + subChildren[i]);

                var newDiv = document.createElement("div");

                var previewImg = document.createElement("img");

                try {
                    var thumbSource = subChildren[i].data.preview.images[0].source.url + "";

                    previewImg.setAttribute('id', subChildren[i].data.name);
                    previewImg.setAttribute('alt', subChildren[i].data.url);
                    previewImg.setAttribute('onClick', "return enlarge(" + subChildren[i].data.name + ");");
                    previewImg.setAttribute('style', ' float: left; object-fit: scale-down; height:300px;');
                    // previewImg.setAttribute('width', 100);
                    // previewImg.setAttribute('height', 100);

                    //get different img sources
                    if (thumbSource.includes("imgur")) {
                        previewImg.setAttribute('src', subChildren[i].data.preview.images[0].source.url +
                            ".png");
                    } else {
                        previewImg.setAttribute('src', subChildren[i].data.preview.images[0].source.url);
                    }

                    newDiv.appendChild(previewImg);
                } catch (err) {
                    console.warn("unknow reddit post type     post data:");
                    console.warn(subChildren[i]);

                    var imgMsg = document.createElement("h4");
                    var t = document.createTextNode("[image broke. sorry.]  ");
                    imgMsg.appendChild(t);
                    newDiv.appendChild(imgMsg);

                }

                var postName = document.createElement("h2");
                var t = document.createTextNode(subChildren[i].data.title);
                postName.appendChild(t);
                newDiv.appendChild(postName);
                
                var postData = document.createElement("p");
                var t = document.createTextNode("");
                postData.setAttribute('id', subChildren[i].data.name + "-descript");
                postData.appendChild(t);
                newDiv.appendChild(postData);

                var postAuth = document.createElement("p");
                var t = document.createTextNode("posted by: " + subChildren[i].data.author);
                postAuth.appendChild(t);
                newDiv.appendChild(postAuth);

                var postDesc = document.createElement("p");
                var t = document.createTextNode("subreddit name: " + subChildren[i].data.subreddit_name_prefixed);
                postDesc.appendChild(t);
                newDiv.appendChild(postDesc);

                newDiv.setAttribute('id', subChildren[i].data.name + '-container');
                newDiv.setAttribute('style', 'height: 300px;');
                divShortcut.appendChild(newDiv);

                var spaceDiv = document.createElement("div");
                spaceDiv.setAttribute('style', 'margin-bottom: 50px;');
                divShortcut.appendChild(spaceDiv);

                latestID = subChildren[i].data.name;
            }

        });

    }

    window.onscroll = function (ev) {
        if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
            loadMorePosts();
        }
    };

    function loadMorePosts() {
        getUrlJSON("https://www.reddit.com/r/" + curSubr + "/new.json?sort=new&after=" + latestID, function (data) {

            var subRawData = data;
            var subChildren = data.data.children;

            for (var i = 0; i < data.data.dist - 3; i++) {
                // console.log(i);
                // console.log(subChildren[i]);

                try {
                    var newDiv = document.createElement("div");

                    var previewImg = document.createElement("img");
                    var thumbSource = subChildren[i].data.preview.images[0].source.url + "";


                    //get different img sources
                    if (thumbSource.includes("imgur") && false) {
                        previewImg.setAttribute('src', subChildren[i].data.preview.images[0].source.url +
                            ".png");
                    } else {
                        previewImg.setAttribute('src', subChildren[i].data.preview.images[0].source.url);
                    }

                    previewImg.setAttribute('id', subChildren[i].data.name);
                    previewImg.setAttribute('alt', subChildren[i].data.url);
                    previewImg.setAttribute('onClick', "return enlarge(" + subChildren[i].data.name + ");");
                    previewImg.setAttribute('style', ' float: left; object-fit: scale-down; height:300px;');
                    // previewImg.setAttribute('width', 100);
                    // previewImg.setAttribute('height', 100);

                    newDiv.appendChild(previewImg);
                } catch (err) {
                    console.warn("unknow reddit post type      post data:");
                    console.warn(subChildren[i]);

                    var imgMsg = document.createElement("h4");
                    var t = document.createTextNode("[image broke. sorry.]  ");
                    imgMsg.appendChild(t);
                    newDiv.appendChild(imgMsg);
                }

                var postName = document.createElement("h2");
                var t = document.createTextNode(subChildren[i].data.title);
                postName.appendChild(t);
                newDiv.appendChild(postName);

                var postAuth = document.createElement("p");
                var t = document.createTextNode("posted by: " + subChildren[i].data.author);
                postAuth.appendChild(t);
                newDiv.appendChild(postAuth);

                var postDesc = document.createElement("p");
                var t = document.createTextNode("subreddit name: " + subChildren[i].data.subreddit_name_prefixed);
                postDesc.appendChild(t);
                newDiv.appendChild(postDesc);

                newDiv.setAttribute('id', subChildren[i].data.name + '-container');
                newDiv.setAttribute('style', 'height: 300px;');
                divShortcut.appendChild(newDiv);

                var spaceDiv = document.createElement("div");
                spaceDiv.setAttribute('style', 'margin-bottom: 50px;');
                divShortcut.appendChild(spaceDiv);
                

                latestID = subChildren[i].data.name;
            }

        });
    }

    function enlarge(imgenID) {

        var divElement = document.getElementById(imgenID.id + "-container");
        var imgElement = document.getElementById(imgenID.id);

        //console.log(divElement.style);

        if (divElement.style.cssText == 'height: 100px;') {
            //small
            divElement.style.cssText = 'height: 300px;';
            imgElement.style.cssText = 'float: left; height:300px;';
            // imgElement.width = 200;
            // imgElement.height = 200;
        } else {
            //big
            divElement.style.cssText = 'height: 100px;';
            imgElement.style.cssText = ' float: left;object-fit: none; height:auto;';
            // imgElement.width = 100;
            // imgElement.height = 100;
        }

    }

    var goButton = document.getElementById("submitSub");

    function getUrlJSON(yourUrl, success) {
        var request = new XMLHttpRequest();
        request.open('GET', yourUrl, true);

        request.onload = function () {
            if (request.status >= 200 && request.status < 400) {
                // Success!
                var data = JSON.parse(request.responseText);

                success(data);
            } else {
                // We reached our target server, but it returned an error
                console.log("target reached but failed loading");
            }
        };
        request.onerror = function () {
            console.log("error loading");
        };
        request.send();
    }
</script>

<!--
    <footer>
        by [cursive-letters]
    </footer>
-->

</html>